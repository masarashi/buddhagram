<div id='map'></div>

<script>
  let map;

  // 初期表示
  // function initMap() {
  //   // 位置情報を取得
  //   navigator.geolocation.getCurrentPosition(function (position) {

  //     LatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

  //     // 取得した位置情報を中心に表示
  //     map = new google.maps.Map(document.getElementById('map'), {
  //       center: LatLng,
  //       zoom: 15
  //     });

  //     marker = new google.maps.Marker({
  //       position: LatLng,
  //       map: map
  //     });
  //   });
  // }

  // スカイツリー
  function initMap(){
    
    LatLng = { lat: 35.710063, lng: 139.8107 };

    map = new google.maps.Map(document.getElementById('map'), {
      center: LatLng,
      zoom: 17,
    });

    marker = new google.maps.Marker({
      position: LatLng,
      map: map
    });
  }

  // 現在地取得処理
  function getPosition() {
    // 現在地を取得
    navigator.geolocation.getCurrentPosition(
      // 取得成功した場合
      function(position) {
          window.location.href = "/spots/search_location?latitude="+position.coords.latitude+"&longitude="+position.coords.longitude
          // $.ajax({
          //   url: "/shops/search_location",
          //   type: "GET",
          //   dataType: 'html',
          //   data: {latitude : position.coords.latitude,
          //         longitude : position.coords.longitude},
          // });
      },
      // 取得失敗した場合
      function(error) {
        switch(error.code) {
          case 1: //PERMISSION_DENIED
            alert("位置情報の利用が許可されていません");
            break;
          case 2: //POSITION_UNAVAILABLE
            alert("現在位置が取得できませんでした");
            break;
          case 3: //TIMEOUT
            alert("タイムアウトになりました");
            break;
          default:
            alert("その他のエラー(エラーコード:"+error.code+")");
            break;
        }
      }
    );
  }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= Rails.application.credentials.gmap[:api_key] %>&callback=initMap" async defer></script>
